
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Common Database Operations - Kohana 3 Development</title>
  <meta name="author" content="Samnan ur Rehman">

  
  <meta name="description" content="Common Database Operations Jan 11th, 2015 5:00 pm As explained previously, the DB class in Kohana provides fast database operations without any &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://samnan.github.io/ko3docs/application/data-manipulation">
  <link href="/ko3docs/favicon.png" rel="icon">
  <link href="/ko3docs/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/ko3docs/atom.xml" rel="alternate" title="Kohana 3 Development" type="application/atom+xml">
  <script src="/ko3docs/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/ko3docs/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/ko3docs/">Kohana 3 Development</a></h1>
  
    <h2>Application developer guide</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/ko3docs/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:samnan.github.io/ko3docs" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<!--ul class="main-navigation">
  <li><a href=""></a></li>
</ul-->

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">Common Database Operations</h1>
    <p class="meta">




<time class='entry-date' datetime='2015-01-11T17:00:00+05:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>5:00 pm</span></time></p>
  </header>
  
  <p>As explained previously, the DB class in Kohana provides fast database operations without any overhead involved, and is ideal for keeping your code portable, as well as easier to read. Below we will show common database operations performed using the DB class.</p>

<h3>Select Queries</h3>

<p>By default, the result of a db select operation is a multidimensional array.</p>

<pre><code>        $users = DB::select()-&gt;from('users')-&gt;execute();
        // $users = array of users, each user record is an array itself
</code></pre>

<p><strong>Selecting records as object array</strong></p>

<pre><code>        $users = DB::select()-&gt;as_object()-&gt;from('users')-&gt;execute();
        // $users = array of user objects
</code></pre>

<p><em>The <code>as_object()</code> method call is not necessary right after select. You can use it anytime before calling <code>execute()</code></em>.</p>

<p><strong>Selecting a particular list of fields from user table</strong></p>

<pre><code>        $users = DB::select('id', 'email')-&gt;as_object()-&gt;from('users')-&gt;execute();
</code></pre>

<p><strong>Selecting a field with an alias</strong></p>

<pre><code>        $users = DB::select('id', array('fullname', 'displayname'))

            -&gt;as_object()-&gt;from('users')-&gt;execute();
        // each user object contains 'id' and 'displayname' property
</code></pre>

<p><strong>Using the infamous NOW() expression in select queries</strong></p>

<pre><code>        $users = DB::select('*', array(DB::expr('NOW()'), 'current_time'))
            -&gt;as_object()-&gt;from('users')-&gt;execute();
        // each user object now also contains 'current_time' property
</code></pre>

<p><em><code>DB::expr()</code> allows using raw database expressions in queries which you do not want to be quoted automatically. Any expression you use with tis method should be escaped/quoted by yourself if it contains a user provided data variable.</em></p>

<p><strong>Joins</strong></p>

<pre><code>        $users = DB::select('users.*', 'addresses.city', 'addresses.zip')
            -&gt;as_object()-&gt;from('users')
            -&gt;join('addresses', 'left')
            -&gt;on('addresses.user_id', '=', 'users.id')
            -&gt;execute();
</code></pre>

<p><em>We are using a left join in our example as not all users may have an address. Skip the second parameter to use a regular join</em>.</p>

<p><strong>Using Where clause</strong></p>

<pre><code>        $active_users = DB::select('users.*', 'addresses.city', 'addresses.zip')
            -&gt;as_object()-&gt;from('users')
            -&gt;join('addresses', 'left')
            -&gt;on('addresses.user_id', '=', 'users.id')
            -&gt;where('users.status', '=', 1)
            -&gt;execute();
</code></pre>

<p><strong>A simple but complex query example</strong></p>

<pre><code>        $active_users = DB::select('users.*', 'addresses.city', 'addresses.zip', DB::expr('NOW() as current_time'))
            -&gt;as_object()
            -&gt;from('users')
            -&gt;join('addresses', 'left')
            -&gt;on('addresses.user_id', '=', 'users.id')
            -&gt;where('users.status', '=', 1)
            -&gt;and_where_open()
                -&gt;where('users.fullname', 'IS NOT', NULL)
                -&gt;or_where('users.email', 'IS NOT', NULL)
            -&gt;and_where_close()
            -&gt;execute();
</code></pre>

<p>Other method follow the same pattern, e.g. <code>group_by()</code>, <code>having()</code> etc.</p>

<h3>Insert Queries</h3>

<pre><code>        $result = DB::insert('users', array('email', 'fullname', 'status'))
                -&gt;values( array('john@mail.com', 'John Connor', 1) )
                -&gt;execute();
</code></pre>

<p><em>The second parameter to <code>insert()</code> is optional, and if not provided means you are providing values for all fields of a table.</em></p>

<p><em>The return value of <code>insert</code> operation is an array containing the result of the operation, and an auto_increment id value if the insert operation was successful</em>.</p>

<h3>Update Queries</h3>

<pre><code>        $user_id = 1;
        $user_data = array('email' =&gt; 'sarah@mail.com', 'fullname' =&gt; 'Sarah Connors');
        DB::update( 'users' )
            -&gt;set( $user_data )
            -&gt;where( 'id', '=', $user_id )
            -&gt;execute();
</code></pre>

<p><em>The return value of <code>update</code> is an array containing the result of the operation, and the number of rows affected</em>.</p>

<p>For more information, consult the Kohana documentation for details of any API for the database module.</p>

<p>Let&rsquo;s move onto <a href="/ko3docs/application/layouts">creating layout template</a> for our application to make it look good in a browser and specifying additional information for the site.</p>

  
    <footer>
      <p class="meta">
        
        




<time class='entry-date' datetime='2015-01-11T17:00:00+05:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>5:00 pm</span></time>
        
      </p>
      
        <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://samnan.github.io/ko3docs/application/data-manipulation/index.html" data-via="" data-counturl="http://samnan.github.io/ko3docs/application/data-manipulation/index.html" >Tweet</a>
  
  
  
</div>

      
    </footer>
  
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Navigation</h1>
  <ul id="recent_posts">
     <li class="post"><a href="/ko3docs/installation">Installation</a></li>
     <li class="post"><a href="/ko3docs/kohana-configuration">Configuration</a></li>
     <li class="post"><a href="/ko3docs/first-run">Running your application</a></li>
     <li class="post"><a href="/ko3docs/configuration/modules">Configuring Modules</a></li>
     <li class="post"><a href="/ko3docs/application/basics">Application Basics</a></li>
     <li class="post"><a href="/ko3docs/application/models">Creating Models</a></li>
     <li class="post"><a href="/ko3docs/application/data-manipulation">Common Database Operations</a></li>
     <li class="post"><a href="/ko3docs/application/how-tos">Mostly Used Stuff</a></li>
     <li class="post"><a href="/ko3docs/application/routes">Creating Routes</a></li>
     <li class="post"><a href="/ko3docs/application/hmvc">HMVC requests</a></li>
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Samnan ur Rehman -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
